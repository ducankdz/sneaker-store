<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
  <!-- Required meta tags-->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="au theme template">
  <meta name="author" content="Hau Nguyen">
  <meta name="keywords" content="au theme template">

  <!-- Title Page-->
  <title>Khuyến Mãi</title>

  <!-- Fontfaces CSS-->
  <link th:href="@{/assets/css/font-face.css}" rel="stylesheet" media="all">
  <link th:href="@{/assets/vendor/font-awesome-4.7/css/font-awesome.min.css}" rel="stylesheet" media="all">
  <link th:href="@{/assets/vendor/font-awesome-5/css/fontawesome-all.min.css}" rel="stylesheet" media="all">
  <link th:href="@{/assets/vendor/mdi-font/css/material-design-iconic-font.min.css}" rel="stylesheet" media="all">

  <!-- Bootstrap CSS-->
  <link th:href="@{/assets/vendor/bootstrap-4.1/bootstrap.min.css}" rel="stylesheet" media="all">

  <!-- Vendor CSS-->
  <link th:href="@{/assets/vendor/animsition/animsition.min.css}" rel="stylesheet" media="all">
  <link th:href="@{/assets/vendor/bootstrap-progressbar/bootstrap-progressbar-3.3.4.min.css}" rel="stylesheet" media="all">
  <link th:href="@{/assets/vendor/wow/animate.css}" rel="stylesheet" media="all">
  <link th:href="@{/assets/vendor/css-hamburgers/hamburgers.min.css}" rel="stylesheet" media="all">
  <link th:href="@{/assets/vendor/slick/slick.css}" rel="stylesheet" media="all">
  <link th:href="@{/assets/vendor/select2/select2.min.css}" rel="stylesheet" media="all">
  <link th:href="@{/assets/vendor/perfect-scrollbar/perfect-scrollbar.css}" rel="stylesheet" media="all">

  <!-- Main CSS-->
  <link th:href="@{/assets/css/theme.css}" rel="stylesheet" media="all">
  <style>
    .limited-width {
      width: 100px;
      overflow: hidden;
      text-overflow: ellipsis;
    }

  </style>
</head>

<body >
<div class="page-wrapper">
  <!-- HEADER MOBILE-->
  <header class="header-mobile d-block d-lg-none">
    <div class="header-mobile__bar">
      <div class="container-fluid">
        <div class="header-mobile-inner">
          <a class="logo" href="index.html">
            <img src="images/icon/logo.png" alt="CoolAdmin" />
          </a>
          <button class="hamburger hamburger--slider" type="button">
                            <span class="hamburger-box">
                                <span class="hamburger-inner"></span>
                            </span>
          </button>
        </div>
      </div>
    </div>
    <nav class="navbar-mobile">
      <div class="container-fluid">
        <ul class="navbar-mobile__list list-unstyled">
          <li class="has-sub">
            <a class="js-arrow" href="#">
              <i class="fas fa-tachometer-alt"></i>Dashboard</a>
            <ul class="navbar-mobile-sub__list list-unstyled js-sub-list">
              <li>
                <a href="index.html">Dashboard 1</a>
              </li>
              <li>
                <a href="index2.html">Dashboard 2</a>
              </li>
              <li>
                <a href="index3.html">Dashboard 3</a>
              </li>
              <li>
                <a href="index4.html">Dashboard 4</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="chart.html">
              <i class="fas fa-chart-bar"></i>Charts</a>
          </li>
          <li>
            <a href="table.html">
              <i class="fas fa-table"></i>Tables</a>
          </li>
          <li>
            <a href="form.html">
              <i class="far fa-check-square"></i>Forms</a>
          </li>
          <li>
            <a href="calendar.html">
              <i class="fas fa-calendar-alt"></i>Calendar</a>
          </li>
          <li>
            <a href="map.html">
              <i class="fas fa-map-marker-alt"></i>Maps</a>
          </li>
          <li class="has-sub">
            <a class="js-arrow" href="#">
              <i class="fas fa-copy"></i>Pages</a>
            <ul class="navbar-mobile-sub__list list-unstyled js-sub-list">
              <li>
                <a href="login.html">Login</a>
              </li>
              <li>
                <a href="register.html">Register</a>
              </li>
              <li>
                <a href="forget-pass.html">Forget Password</a>
              </li>
            </ul>
          </li>
          <li class="has-sub">
            <a class="js-arrow" href="#">
              <i class="fas fa-desktop"></i>UI Elements</a>
            <ul class="navbar-mobile-sub__list list-unstyled js-sub-list">
              <li>
                <a href="button.html">Button</a>
              </li>
              <li>
                <a href="badge.html">Badges</a>
              </li>
              <li>
                <a href="tab.html">Tabs</a>
              </li>
              <li>
                <a href="card.html">Cards</a>
              </li>
              <li>
                <a href="alert.html">Alerts</a>
              </li>
              <li>
                <a href="progress-bar.html">Progress Bars</a>
              </li>
              <li>
                <a href="modal.html">Modals</a>
              </li>
              <li>
                <a href="switch.html">Switchs</a>
              </li>
              <li>
                <a href="grid.html">Grids</a>
              </li>
              <li>
                <a href="fontawesome.html">Fontawesome Icon</a>
              </li>
              <li>
                <a href="typo.html">Typography</a>
              </li>
            </ul>
          </li>
        </ul>
      </div>
    </nav>
  </header>
  <!-- END HEADER MOBILE-->

  <!-- MENU SIDEBAR-->
  <div th:replace="/admin_sidebar :: sidebar"></div>
  <!-- END MENU SIDEBAR-->

  <!-- PAGE CONTAINER-->
  <div class="page-container">
    <!-- HEADER DESKTOP-->
    <div th:replace="/admin_header :: header"></div>
    <!-- HEADER DESKTOP-->
    <div class="main-content">
      <div class="section__content section__content--p30">
        <div class="container-fluid">
          <div class="row">
            <div class="col-md-12">
              <div class="overview-wrap">
                <h2 class="title-1">Quản Lý Khuyến Mãi</h2>
                <button type="button" class="au-btn au-btn-icon au-btn--blue" data-toggle="modal" data-target="#addModal">
                  <i class="zmdi zmdi-plus"></i>Thêm Khuyến Mãi</button>
              </div>
            </div>
          </div>
          <div class="row mt-4">
            <div class="col-lg-12 col-md-12 col-xl-12">
              <div class="table-responsive table--no-card m-b-30">
                <table class="table table-borderless table-striped table-earning">
                  <thead>
                  <tr>
                    <th>ID</th>
                    <th>Mã Code</th>
                    <th>Trạng Thái</th>
                    <th>Điều Kiện Áp Dụng</th>
                    <th></th>
                    <th></th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr th:each="coupon : ${coupons}">
                    <td th:utext="${coupon.id}"></td>
                    <td th:utext="${coupon.code}"></td>
                    <td>
                      <select name="active" class="form-control" th:data-id="${coupon.id}">
                        <option th:selected="${coupon.active == true}" value="1">Hoạt Động</option>
                        <option th:selected="${coupon.active == false}" value="0">Ngừng Hoạt Động</option>
                      </select>
                    </td>
                    <td>
                      <div th:each="condition : ${coupon.conditions}">
                        <p th:if="${condition.attribute == 'total_money'}">Giá trị đơn hàng:
                          <span style="color:cornflowerblue;font-size: 20px;">
                            <span th:if="${condition.operator == '>'}">Lớn hơn</span>
                            <span th:if="${condition.operator == '<'}">Nhỏ hơn</span>
                            <span th:if="${condition.operator == '='}">Bằng</span>
                            <span th:utext="${condition.value}"></span>
                            <span th:utext="'( Giảm ' + ${#numbers.formatInteger(condition.discount * 100, 0)} + '% )'"></span>
                        </span>
                        </p>
                        <p th:if="${condition.attribute == 'applicable_date'}">Ngày áp dụng:
                          <span style="color:coral;font-size: 20px;">
                            <span th:if="${condition.operator == '>'}">Sau Ngày</span>
                            <span th:if="${condition.operator == '<'}">Trước</span>
                            <span th:if="${condition.operator == '='}">Ngày</span>
                            <span th:utext="${condition.value}"></span>
                            <span th:utext="'( Giảm ' + ${#numbers.formatInteger(condition.discount * 100, 0)} + '% )'"></span>

                          </span>
                        </p>
                        <p th:if="${condition.attribute == 'quantity'}">Số Sản phẩm:
                          <span style="color:cadetblue ;font-size: 20px;">
                            <span th:if="${condition.operator == '>'}">Lớn hơn</span>
                            <span th:if="${condition.operator == '<'}">Nhỏ hơn</span>
                            <span th:if="${condition.operator == '='}">Bằng</span>
                            <span th:utext="${condition.value}"></span>
                            <span th:utext="'( Giảm ' + ${#numbers.formatInteger(condition.discount * 100, 0)} + '% )'"></span>

                          </span>
                        </p>
                      </div>
                    </td>
                    <td>
                      <input type="button" value="Lưu Thay Đổi" class="btn btn-success"
                             data-toggle="modal" data-target="#updateModal"
                              th:data-id="${coupon.id}"
                      >
                    </td>
                    <td>
                      <input type="button" value="Xoá" class="btn btn-danger"
                             data-toggle="modal" data-target="#deleteModal"
                             th:data-id="${coupon.id}"
                      >
                    </td>
                  </tr>

                  </tbody>
                </table>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>

    <!-- END MAIN CONTENT-->
    <!-- END PAGE CONTAINER-->
  </div>

</div>
<!-- modal medium -->
<form th:action="@{/admin/coupon/add}" th:object="${couponDTO}" method="post">
  <div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="mediumModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">

        <div class="modal-content" style="margin-top: 200px;">
          <div class="modal-header">
            <h5 class="modal-title" id="mediumModalLabel">Thêm Khuyến Mãi</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>

          <div class="modal-body">
            <div class="row form-group">
              <div class="col col-md-3">
                <label class=" form-control-label">Mã Khuyến Mãi</label>
              </div>
              <div class="col-12 col-md-9">
                <input th:field="*{code}" type="text" class="form-control">
              </div>
            </div>
            <div class="row form-group">
              <div class="col col-md-12">
                <label class=" form-control-label">Điều Kiện (Chọn ít nhất 1 trong 3 điều kiện dưới)</label>
              </div>
            </div>
            <div class="row form-group">
              <div class="col col-md-3">
                <label class=" form-control-label">Giá Trị Đơn Hàng</label>
              </div>
              <div class="col col-md-2">
                <select th:field="*{couponConditions[0].operator}" class="form-control">
                  <option value=">" selected>Lớn Hơn</option>
                  <option value="<">Nhỏ Hơn</option>
                </select>
              </div>
              <div class="col col-md-3">
                <input th:field="*{couponConditions[0].value}" type="text" class="form-control" placeholder="Nhập số tiền">
              </div>
              <div class="col col-md-4">
                <input th:field="*{couponConditions[0].discount}" type="text" class="form-control" placeholder="Nhập số phần trăm giảm">
              </div>
            </div>
            <div class="row form-group">
              <div class="col col-md-3">
                <label class=" form-control-label">Thời Gian</label>
              </div>
              <div class="col col-md-2">
                <select th:field="*{couponConditions[1].operator}" class="form-control">
                  <option value="<" selected>Trước</option>
                  <option value="=">Bằng</option>
                  <option value=">">Sau</option>
                </select>
              </div>
              <div class="col col-md-3">
                <input th:field="*{couponConditions[1].value}" type="date" class="form-control" placeholder="yyyy/mm/dd">
              </div>
              <div class="col col-md-4">
                <input th:field="*{couponConditions[1].discount}" type="text" class="form-control" placeholder="Nhập số phần trăm giảm">
              </div>
            </div>
            <div class="row form-group">
              <div class="col col-md-3">
                <label class=" form-control-label">Số Sản Phẩm</label>
              </div>
              <div class="col col-md-2">
                <select th:field="*{couponConditions[2].operator}" class="form-control">
                  <option value=">" selected>Lớn Hơn</option>
                  <option value="=">Bằng</option>
                  <option value="<">Nhỏ Hơn</option>
                </select>
              </div>
              <div class="col col-md-3">
                <input th:field="*{couponConditions[2].value}" type="number" min="1"  class="form-control" placeholder="Nhập số sản phẩm">
              </div>
              <div class="col col-md-4">
                <input th:field="*{couponConditions[2].discount}" type="text" class="form-control" placeholder="Nhập số phần trăm giảm">
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Huỷ</button>
            <button type="submit" class="btn btn-primary">Thêm</button>
          </div>
        </div>

    </div>
  </div>
</form>

<div class="modal fade" id="updateModal" tabindex="-1" role="dialog" aria-labelledby="mediumModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content" style="margin-top: 300px;">
      <div class="modal-header">
        <h5 class="modal-title" id="mediumModalLabel">Cập Nhật Khuyến Mãi</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body">
        <p>Bạn có chắc chắn muốn cập nhật khuyến mãi này ?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Huỷ</button>
        <a href="" class="btn btn-primary">Lưu Thay Đổi</a>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="mediumModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content" style="margin-top: 300px;">
      <div class="modal-header">
        <h5 class="modal-title" id="mediumModalLabel">Xoá Khuyến Mãi</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>Bạn có chắc chắn muốn xoá khuyến mãi này ?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Huỷ</button>
        <a href="" class="btn btn-primary">Xoá</a>
      </div>

    </div>
  </div>
</div>


<div th:if="${message != null}">
  <div th:replace="/message :: alrtFragment(${message})"></div>
</div>

<div th:if="${errorMessage != null}">
  <div th:replace="/message_error :: alrtFragment(${errorMessage})"></div>
</div>

<!-- Jquery JS-->
<script th:src="@{/assets/vendor/jquery-3.2.1.min.js}"></script>
<!-- Bootstrap JS-->
<script th:src="@{/assets/vendor/bootstrap-4.1/popper.min.js}"></script>
<script th:src="@{/assets/vendor/bootstrap-4.1/bootstrap.min.js}"></script>
<!-- Vendor JS       -->
<script th:src="@{/assets/vendor/slick/slick.min.js}">
</script>
<script th:src="@{/assets/vendor/wow/wow.min.js}"></script>
<script th:src="@{/assets/vendor/animsition/animsition.min.js}"></script>
<script th:src="@{/assets/vendor/bootstrap-progressbar/bootstrap-progressbar.min.js}">
</script>
<script th:src="@{/assets/vendor/counter-up/jquery.waypoints.min.js}"></script>
<script th:src="@{/assets/vendor/counter-up/jquery.counterup.min.js}">
</script>
<script th:src="@{/assets/vendor/circle-progress/circle-progress.min.js}"></script>
<script th:src="@{/assets/vendor/perfect-scrollbar/perfect-scrollbar.js}"></script>
<script th:src="@{/assets/vendor/chartjs/Chart.bundle.min.js}"></script>
<script th:src="@{/assets/vendor/select2/select2.min.js}">
</script>

<!-- Main JS-->
<script th:src="@{/assets/js/main1.js}"></script>

<script>
  $('#deleteModal').on('show.bs.modal', function (event) {
    var button = $(event.relatedTarget); // Button that triggered the modal
    var couponId = button.data('id'); // Extract info from data-* attributes

    var modal = $(this);
    modal.find('.modal-footer .btn-primary').attr('href', '/admin/coupon/delete/' + couponId);
  });
</script>

<script>
  $('#updateModal').on('show.bs.modal', function (event) {
    var button = $(event.relatedTarget); // Button that triggered the modal
    var couponId = button.data('id'); // Get coupon ID from button

    // Lấy giá trị của select box tương ứng với coupon ID
    var active = $('select[data-id="' + couponId + '"]').val();

    var modal = $(this);
    modal.find('.modal-footer .btn-primary').attr('href', '/admin/coupon/update/' + couponId + '?active=' + active);
  });

</script>

</body>

</html>
<!-- end document-->
